<link rel="import" href="/bower_components/polymer/polymer.html">

<!--
<link rel="import" href="/bower_components/px-deck-selector/px-deck-selector.html">
 --><link rel="import" href="/bower_components/iron-ajax/iron-ajax.html">

<!-- local px-deck -->
<!-- <link rel="import" href="/elements/px-deck/px-deck-index.html"> -->
<link rel="import" href="/elements/bar-chart-card/bar-chart-card.html">
<link rel="import" href="/elements/scatter-plot-card/scatter-plot-card.html">
<link rel="import" href="/elements/time-series-card/time-series-card.html">
<link rel="import" href="/elements/values-card/values-card.html">
<link rel="import" href="/elements/latest-tag-data/latest-tag-data.html">

<dom-module id="dashboards-view">
  <template>

    <script type="text/javascript" src="../../bower_components/es6-promise/es6-promise.min.js"></script>

    <iron-ajax
          id="getTags"
          auto
          method="GET"
          url="/predix-api/predix-timeseries/v1/tags"
          handle-as="json"
          content-type="application/json"
          on-response="_tagResponse"
    ></iron-ajax>
    <iron-ajax
          id="test"
          auto
          method="GET"
          url="/predix-api/demand"
          handle-as="json"
          content-type="application/json"
          on-response="_demandResponse"
    ></iron-ajax>
    <iron-ajax
          id="getDemand"
          auto
          method="GET"
          url="/predix-api/external"
          handle-as="json"
          content-type="application/json"
          on-response="_demandResponse"
    ></iron-ajax>
  <!--   <iron-ajax
          id="getWindspeed"
          auto
          method="GET"
          url="/predix-api/external/windspeed"
          handle-as="json"
          content-type="application/json"
          on-response="_demandResponse"
    ></iron-ajax> -->

    <!-- Show all of the tag latest values on one card -->
    <!-- <values-card id="allTags" card-title="Real Time Dashboard" tags="[[tags]]"></values-card> -->

    <!-- Show latest value on one card per tag -->
    <span class="layout">
      <latest-data-card id="buttonTag" class="layout__item"
          card-title="Button" tag="Button-xlp-[[deviceName]]"></latest-data-card>
      <latest-data-card id="coalTag" class="layout__item"
        card-title="Coal Power" tag="CoalPower-xlp-[[deviceName]]"></latest-data-card>
      <latest-data-card id="gasTag" class="layout__item"
        card-title="Gas Power" tag="GasPower-xlp-[[deviceName]]"></latest-data-card>
      <latest-data-card id="humidityTag" class="layout__item"
        card-title="Humidity" tag="Humidity-xlp-[[deviceName]]"></latest-data-card>
        <!-- Add more data cards here! -->
    </span>

    <!-- <scatter-plot-card></scatter-plot-card>-->

    <!-- Show time series data as a line chart -->
    <time-series-card id="tsLineChart" card-title="Time Series Card - Line" tags="[[tagVals]]" hide-bar ></time-series-card>
    <!-- Show time series data as a bar chart -->
    <time-series-card id="tsBarChart" card-title="Time Series Card - Bar" tags="[[tagVals]]" hide-line></time-series-card>

  </template>
  <script>

    // This is the device name you are using
    var deviceName = 'trainer-03';
    //var deviceName = '09'; //'trainer-09';

    Polymer({

      is: 'dashboards-view',

      properties: {
        tags: {
          type: Object,
          value: {}
        },
        tagVals: {
          type: Array
        },
        deviceName: {
          type: String,
          value: '09'
        }
      },

      ready: function ready() {
        var _this = this;



      },
      _tagResponse: function(e, details){
        let tags = details.response.results;
        let temp = [];
        let component = {
          tags: []
        };

        tags.forEach((tag) => {
          if(tag.indexOf(this.deviceName)!== -1){
            temp.push(tag);
            component.tags.push({
              name: [ tag ]
            });
          }
        });
        this.tags = {
          "tags": component.tags
        };
        this.tagVals = temp;
      },
      _demandResponse: function(){
        console.log("demand!!");
      }
      // ,
      // _getTag: function(str){
      //   if(this.tagVals){
      //     return this.tagVals.find((tag) => {
      //         return tag === str;
      //       });
      //   }
      // }
    });
  </script>
</dom-module>

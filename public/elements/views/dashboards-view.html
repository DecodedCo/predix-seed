<link rel="import" href="/bower_components/polymer/polymer.html">
<link rel="import" href="/bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="/elements/bar-chart-card/bar-chart-card.html">
<link rel="import" href="/elements/scatter-plot-card/scatter-plot-card.html">
<link rel="import" href="/elements/time-series-card/time-series-card.html">
<link rel="import" href="/elements/values-card/values-card.html">
<link rel="import" href="/elements/latest-tag-data/latest-tag-data.html">

<dom-module id="dashboards-view">
  <template>

    <script type="text/javascript" src="../../bower_components/es6-promise/es6-promise.min.js"></script>

    <iron-ajax
          id="getTags"
          auto
          method="GET"
          url="/predix-api/predix-timeseries/v1/tags"
          handle-as="json"
          content-type="application/json"
          on-response="_tagResponse"
    ></iron-ajax>
    <iron-ajax
          id="getWindspeed"
          auto
          method="GET"
          url="/external/api/windspeed"
          handle-as="json"
          content-type="application/json"
          on-response="_windSpeedResponse"
    ></iron-ajax>

    <!-- Show latest value on one card per tag -->
    <span class="layout">
      <latest-data-card id="coalTag" class="layout__item"
        card-title="Coal Power (MW)" tag="CoalPower-xlp-[[deviceName]]"></latest-data-card>
      <latest-data-card id="gasTag" class="layout__item"
        card-title="Gas Power (MW)" tag="GasPower-xlp-[[deviceName]]"></latest-data-card>
      <latest-data-card id="windPowerTag" class="layout__item"
        card-title="Wind Power (MW)" tag="WindPower-xlp-[[deviceName]]"></latest-data-card>
      <latest-data-card id="totalPowerTag" class="layout__item"
        card-title="Total Power (MW)" tag="TotalPower-xlp-[[deviceName]]"></latest-data-card>
      <latest-data-card id="temperatureTag" class="layout__item"
        card-title="Gearbox Temperature (&deg;C)" tag="Temperature-xlp-[[deviceName]]"></latest-data-card>
      <latest-data-card id="humidityTag" class="layout__item"
        card-title="Gearbox Humidity (%)" tag="Humidity-xlp-[[deviceName]]"></latest-data-card>
      <!-- How can we set the windSpeed variable? -->
      <latest-data-card id="windSpeed" class="layout__item"
        card-title="Wind Speed (m/s)" tag="[[windSpeed]]"></latest-data-card>
      <latest-data-card id="demand" class="layout__item"
        card-title="Demand (MW)" tag="Demand"></latest-data-card>
    </span>

    <!-- <scatter-plot-card></scatter-plot-card>-->
    <!-- Show time series data as a line chart -->
    <time-series-card id="tsLineChart" card-title="Time Series Card - Line" tags="[[tagVals]]" hide-bar></time-series-card>
    <!-- Show time series data as a bar chart -->
    <time-series-card id="tsBarChart" card-title="Time Series Card - Bar" tags="[[tagVals]]" hide-line></time-series-card>

  </template>
  <script>

    // This is the device name you are using
    var deviceName = 'trainer-03';

    Polymer({

      is: 'dashboards-view',

      properties: {
        tags: {
          type: Object,
          value: {}
        },
        tagVals: {
          type: Array
        },
        deviceName: {
          type: String,
          value: deviceName
        }
      },

      ready: function ready() {
        var _this = this;
      },
      _tagResponse: function(e, details){
        let tags = details.response.results;
        let temp = [];
        let component = {
          tags: []
        };

        tags.forEach((tag) => {
          if(tag.indexOf(this.deviceName)!== -1){
            temp.push(tag);
            component.tags.push({
              name: [ tag ]
            });
          }
        });
        this.tags = {
          "tags": component.tags
        };
        this.tagVals = temp;
      },
      _windSpeedResponse: function(){
        console.log("WindSpeed!!");
      }
    });
  </script>
</dom-module>
